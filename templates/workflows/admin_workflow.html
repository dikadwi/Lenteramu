{% extends "base.html" %}

{% block title %}Admin Workflow - LENTERAMU{% endblock %}

{% block content %}
<div class="container">
    <h1><i class="fas fa-user-shield"></i> Alur Kerja Administrator</h1>
    
    <div class="card">
        <h2>Control Panel Administrator LENTERAMU</h2>
        <p>Kelola sistem, monitor performa, dan pastikan keamanan platform pembelajaran</p>
    </div>

    <!-- System Overview -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ total_users }}</div>
            <div class="stat-label">Total Pengguna</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ active_users }}</div>
            <div class="stat-label">Pengguna Aktif</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ system_health.uptime }}</div>
            <div class="stat-label">System Uptime</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ system_health.response_time }}</div>
            <div class="stat-label">Response Time</div>
        </div>
    </div>

    <!-- Admin Workflow Steps -->
    <div class="card">
        <h3><i class="fas fa-route"></i> Alur Kerja Administrasi</h3>
        <div class="admin-workflow">
            <div class="workflow-section">
                <h4><i class="fas fa-sign-in-alt"></i> 1. Login & Dashboard</h4>
                <div class="workflow-actions">
                    <button class="btn btn-sm" onclick="accessDashboard()">Akses Dashboard</button>
                    <button class="btn btn-sm btn-secondary" onclick="viewSystemStatus()">Status Sistem</button>
                </div>
            </div>

            <div class="workflow-section">
                <h4><i class="fas fa-users-cog"></i> 2. Manajemen Data Pengguna</h4>
                <div class="workflow-actions">
                    <button class="btn btn-sm" onclick="manageUsers()">Kelola Pengguna</button>
                    <button class="btn btn-sm btn-secondary" onclick="viewUserRoles()">Role Management</button>
                    <button class="btn btn-sm btn-secondary" onclick="bulkOperations()">Bulk Operations</button>
                </div>
            </div>

            <div class="workflow-section">
                <h4><i class="fas fa-chart-line"></i> 3. Pemantauan Sistem</h4>
                <div class="workflow-actions">
                    <button class="btn btn-sm" onclick="systemMonitoring()">Monitor Real-time</button>
                    <button class="btn btn-sm btn-secondary" onclick="performanceMetrics()">Performance Metrics</button>
                    <button class="btn btn-sm btn-secondary" onclick="logAnalysis()">Log Analysis</button>
                </div>
            </div>

            <div class="workflow-section">
                <h4><i class="fas fa-shield-alt"></i> 4. Pengaturan Keamanan</h4>
                <div class="workflow-actions">
                    <button class="btn btn-sm" onclick="securitySettings()">Security Config</button>
                    <button class="btn btn-sm btn-secondary" onclick="accessControl()">Access Control</button>
                    <button class="btn btn-sm btn-secondary" onclick="auditLogs()">Audit Logs</button>
                </div>
            </div>

            <div class="workflow-section">
                <h4><i class="fas fa-tools"></i> 5. Penanganan Masalah</h4>
                <div class="workflow-actions">
                    <button class="btn btn-sm" onclick="troubleshoot()">Troubleshooting</button>
                    <button class="btn btn-sm btn-secondary" onclick="systemMaintenance()">Maintenance</button>
                    <button class="btn btn-sm btn-secondary" onclick="backupRestore()">Backup & Restore</button>
                </div>
            </div>

            <div class="workflow-section">
                <h4><i class="fas fa-cog"></i> 6. Konfigurasi Platform</h4>
                <div class="workflow-actions">
                    <button class="btn btn-sm" onclick="platformSettings()">Platform Config</button>
                    <button class="btn btn-sm btn-secondary" onclick="featureToggle()">Feature Toggle</button>
                    <button class="btn btn-sm btn-secondary" onclick="systemUpdates()">System Updates</button>
                </div>
            </div>
        </div>
    </div>

    <!-- System Health Dashboard -->
    <div class="card-grid">
        <div class="card">
            <h3><i class="fas fa-heartbeat"></i> System Health</h3>
            <div class="health-metrics">
                <div class="metric-item">
                    <span class="metric-label">Server Status</span>
                    <span class="metric-value healthy">Online</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Database</span>
                    <span class="metric-value healthy">Connected</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">API Services</span>
                    <span class="metric-value healthy">All Active</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Error Rate</span>
                    <span class="metric-value warning">{{ system_health.error_rate }}</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h3><i class="fas fa-chart-pie"></i> Resource Usage</h3>
            <canvas id="resourceChart" width="300" height="200"></canvas>
        </div>
    </div>

    <!-- System Metrics -->
    <div class="card">
        <h3><i class="fas fa-tachometer-alt"></i> System Metrics</h3>
        {% if metrics %}
            <div class="metrics-grid">
                {% for metric in metrics %}
                <div class="metric-card">
                    <div class="metric-name">{{ metric.metric_name.replace('_', ' ').title() }}</div>
                    <div class="metric-value">{{ metric.metric_value }}{% if metric.metric_unit %}{{ metric.metric_unit }}{% endif %}</div>
                    <div class="metric-time">{{ metric.recorded_at }}</div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No metrics available</p>
        {% endif %}
    </div>

    <!-- Recent System Activities -->
    <div class="card">
        <h3><i class="fas fa-list"></i> Aktivitas Sistem Terbaru</h3>
        {% if recent_activities %}
            <div class="activities-list">
                {% for activity in recent_activities %}
                <div class="activity-row">
                    <div class="activity-icon">
                        {% if activity.activity_type == 'quiz_attempt' %}
                            <i class="fas fa-question-circle"></i>
                        {% elif activity.activity_type == 'complete' %}
                            <i class="fas fa-check-circle"></i>
                        {% else %}
                            <i class="fas fa-eye"></i>
                        {% endif %}
                    </div>
                    <div class="activity-content">
                        <strong>{{ activity.user.full_name }}</strong> - {{ activity.activity_type.replace('_', ' ').title() }}
                        {% if activity.score %}
                            (Score: {{ activity.score }})
                        {% endif %}
                    </div>
                    <div class="activity-time">{{ activity.created_at.strftime('%d/%m %H:%M') }}</div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p>Tidak ada aktivitas terbaru</p>
        {% endif %}
    </div>

    <!-- Emergency Actions -->
    <div class="card">
        <h3><i class="fas fa-exclamation-triangle"></i> Emergency Actions</h3>
        <div class="emergency-actions">
            <button class="btn btn-danger" onclick="confirmAction('System Maintenance Mode')">
                <i class="fas fa-pause"></i> Maintenance Mode
            </button>
            <button class="btn btn-warning" onclick="confirmAction('Clear System Cache')">
                <i class="fas fa-broom"></i> Clear Cache
            </button>
            <button class="btn btn-info" onclick="confirmAction('Force User Logout')">
                <i class="fas fa-sign-out-alt"></i> Force Logout All
            </button>
            <button class="btn btn-success" onclick="confirmAction('Backup Database')">
                <i class="fas fa-database"></i> Emergency Backup
            </button>
        </div>
    </div>
</div>

<style>
.admin-workflow {
    margin-top: 1rem;
}

.workflow-section {
    padding: 1rem;
    margin: 1rem 0;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #667eea;
}

.workflow-section h4 {
    margin: 0 0 1rem 0;
    color: #333;
}

.workflow-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.health-metrics {
    margin-top: 1rem;
}

.metric-item {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
}

.metric-value.healthy {
    color: #28a745;
    font-weight: bold;
}

.metric-value.warning {
    color: #ffc107;
    font-weight: bold;
}

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.metric-card {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
}

.metric-name {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 0.5rem;
}

.metric-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #667eea;
}

.metric-time {
    font-size: 0.8rem;
    color: #999;
    margin-top: 0.5rem;
}

.activities-list {
    margin-top: 1rem;
    max-height: 300px;
    overflow-y: auto;
}

.activity-row {
    display: flex;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
}

.activity-icon {
    width: 40px;
    text-align: center;
    color: #667eea;
}

.activity-content {
    flex: 1;
    margin: 0 1rem;
}

.activity-time {
    color: #666;
    font-size: 0.9rem;
}

.emergency-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    margin-top: 1rem;
}
</style>

<script>
function accessDashboard() {
    window.location.href = '/dashboard/admin';
}

function viewSystemStatus() {
    window.location.href = '/monitoring';
}

function manageUsers() {
    showToast('User Management akan segera tersedia!', 'info');
}

function viewUserRoles() {
    showToast('Role Management sedang dikembangkan', 'info');
}

function bulkOperations() {
    showToast('Bulk Operations akan segera tersedia!', 'info');
}

function systemMonitoring() {
    window.location.href = '/monitoring';
}

function performanceMetrics() {
    showToast('Performance Metrics dashboard sedang dikembangkan', 'info');
}

function logAnalysis() {
    showToast('Log Analysis tools akan segera tersedia!', 'info');
}

function securitySettings() {
    showToast('Security Configuration akan segera tersedia!', 'info');
}

function accessControl() {
    showToast('Access Control management sedang dikembangkan', 'info');
}

function auditLogs() {
    showToast('Audit Logs viewer akan segera tersedia!', 'info');
}

function troubleshoot() {
    showToast('Troubleshooting tools sedang dikembangkan', 'info');
}

function systemMaintenance() {
    showToast('System Maintenance tools akan segera tersedia!', 'info');
}

function backupRestore() {
    showToast('Backup & Restore tools sedang dikembangkan', 'info');
}

function platformSettings() {
    showToast('Platform Configuration akan segera tersedia!', 'info');
}

function featureToggle() {
    showToast('Feature Toggle management sedang dikembangkan', 'info');
}

function systemUpdates() {
    showToast('System Updates akan segera tersedia!', 'info');
}

function confirmAction(action) {
    if (confirm(`Yakin ingin melakukan: ${action}?`)) {
        showToast(`${action} akan dijalankan...`, 'warning');
    }
}

function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = `alert alert-${type}`;
    toast.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
    toast.style.position = 'fixed';
    toast.style.top = '20px';
    toast.style.right = '20px';
    toast.style.zIndex = '10000';
    toast.style.minWidth = '300px';
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        document.body.removeChild(toast);
    }, 3000);
}

// Resource usage chart
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('resourceChart');
    if (ctx && typeof Chart !== 'undefined') {
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['CPU', 'Memory', 'Disk', 'Available'],
                datasets: [{
                    data: [25, 35, 20, 20],
                    backgroundColor: [
                        '#ff6384',
                        '#36a2eb',
                        '#ffcd56',
                        '#4bc0c0'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}
